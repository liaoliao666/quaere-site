import { Callout } from "nextra-theme-docs";

# Next.js SSG å’Œ SSR

## App Router [#app-dir]

### æœåŠ¡å™¨ç»„ä»¶ [#rsc]

<Callout type="default" emoji="âœ…">
  åœ¨ Next.js App Router ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç»„ä»¶éƒ½æ˜¯ æœåŠ¡å™¨ç»„ä»¶
  (RSC)ã€‚**ä½ åªèƒ½åœ¨ RSC ä¸­å¯¼å…¥ Quaere çš„æ ¸å¿ƒ APIã€‚**
</Callout>

```tsx filename="app/page.tsx" copy
import { createQueryClient, query, dehydrate } from "quaere"; // âœ… å¯åœ¨æœåŠ¡å™¨ç»„ä»¶ä¸­ä½¿ç”¨
```

<Callout type="error">
  ä½ ä¸èƒ½å¯¼å…¥ Quaere çš„å…¶ä»–ä»»ä½• React ç›¸å…³çš„ APIï¼Œå› ä¸ºå®ƒä»¬åœ¨ RSC ä¸­ä¸å¯ç”¨ã€‚
</Callout>

```tsx filename="app/page.tsx" highlight={1}
import { useQuery, useMutation } from "quaere"; // âŒ è¿™åœ¨æœåŠ¡å™¨ç»„ä»¶ä¸­ä¸å¯ç”¨
```

### å®¢æˆ·ç«¯ç»„ä»¶

ä½ å¯ä»¥ä½¿ç”¨ `'use client'` æŒ‡ä»¤æˆ–åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­å¯¼å…¥ Quaereï¼Œä¸¤ç§æ–¹å¼éƒ½å…è®¸ä½ ä½¿ç”¨ Quaere å®¢æˆ·ç«¯æ•°æ®è¯·æ±‚é’©å­ã€‚

```tsx filename="app/page.tsx" highlight={1} copy
'use client'
import { useQuery } from 'quaere'
export default Page() {
  const { data } = useQuery('/api/user', fetcher)
  return <h1>{data.name}</h1>
}
```

å¦‚æœä½ éœ€è¦åœ¨æœåŠ¡å™¨ç»„ä»¶çš„ layout æˆ– page ä¸­é…ç½®å…¨å±€è®¾ç½®ä½¿ç”¨ QueryClientProviderï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æä¾›è€…å®¢æˆ·ç«¯ç»„ä»¶æ¥è®¾ç½®æä¾›è€…å’Œé…ç½®ï¼Œç„¶ååœ¨æœåŠ¡å™¨ç»„ä»¶é¡µé¢ä¸­ä½¿ç”¨å®ƒã€‚

```tsx filename="app/provider.tsx" copy
"use client";
import { QueryClientProvider, createQueryClient } from "quaere";
const queryClient = createQueryClient();
export const Provider = ({ children }) => {
  return (
    <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>
  );
};
```

```tsx filename="app/page.tsx" copy
// è¿™ä»ç„¶æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ç»„ä»¶
import { Provider } from './provider'
export default Page() {
  return (
    <Provider>
      <h1>hello Quaere</h1>
    </Provider>
  )
}
```

## å®¢æˆ·ç«¯æ•°æ®è¯·æ±‚ [#client-side-data-fetching]

å¦‚æœä½ çš„é¡µé¢åŒ…å«é¢‘ç¹æ›´æ–°çš„æ•°æ®ï¼Œè€Œä¸”ä¸éœ€è¦é¢„æ¸²æŸ“æ•°æ®ï¼Œé‚£ä¹ˆ Quaere éå¸¸é€‚åˆï¼Œæ— éœ€ç‰¹æ®Šè®¾ç½®ï¼šåªéœ€å¯¼å…¥ useQueryï¼Œå¹¶åœ¨ä½¿ç”¨æ•°æ®çš„ä»»ä½•ç»„ä»¶ä¸­ä½¿ç”¨è¯¥é’©å­ã€‚

å·¥ä½œåŸç†å¦‚ä¸‹ï¼š

- é¦–å…ˆï¼Œç«‹å³æ˜¾ç¤ºä¸å¸¦æ•°æ®çš„é¡µé¢ã€‚ä½ å¯ä»¥ä¸ºç¼ºå°‘çš„æ•°æ®æ˜¾ç¤ºåŠ è½½çŠ¶æ€ã€‚
- ç„¶åï¼Œåœ¨å®¢æˆ·ç«¯ä¸Šè¯·æ±‚æ•°æ®å¹¶åœ¨å‡†å¤‡å°±ç»ªæ—¶æ˜¾ç¤ºå®ƒã€‚
  è¿™ç§æ–¹æ³•éå¸¸é€‚ç”¨äºç”¨æˆ·ä»ªè¡¨æ¿é¡µé¢ï¼Œä¾‹å¦‚ã€‚å› ä¸ºä»ªè¡¨æ¿æ˜¯ä¸€ä¸ªç§æœ‰çš„ã€ç”¨æˆ·ç‰¹å®šçš„é¡µé¢ï¼ŒSEO ä¸ç›¸å…³ï¼Œé¡µé¢ä¸éœ€è¦é¢„æ¸²æŸ“ã€‚æ•°æ®ç»å¸¸æ›´æ–°ï¼Œéœ€è¦åœ¨è¯·æ±‚æ—¶è¯·æ±‚æ•°æ®ã€‚

## ä½¿ç”¨é»˜è®¤æ•°æ®è¿›è¡Œé¢„æ¸²æŸ“ [#pre-rendering-with-default-data]

å¦‚æœé¡µé¢å¿…é¡»é¢„æ¸²æŸ“ï¼ŒNext.js æ”¯æŒ [ä¸¤ç§å½¢å¼çš„é¢„æ¸²æŸ“](https://nextjs.org/docs/basic-features/data-fetching)ï¼š**é™æ€ç”Ÿæˆ (SSG)** å’Œ **æœåŠ¡å™¨ç«¯æ¸²æŸ“ (SSR)**ã€‚

ä¸ `Quaere` ä¸€èµ·ï¼Œä½ å¯ä»¥ä¸º SEO é¢„æ¸²æŸ“é¡µé¢ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯ä¸Šå…·æœ‰ç¼“å­˜ã€é‡æ–°éªŒè¯ã€ç„¦ç‚¹è·Ÿè¸ªã€å®šæœŸé‡æ–°è¯·æ±‚ç­‰åŠŸèƒ½ã€‚

ä½ å¯ä»¥ä½¿ç”¨ `HydrationBoundary` çš„ `state` é€‰é¡¹å°†é¢„å–çš„æ•°æ®ä¼ é€’ä¸ºæ‰€æœ‰ `Quaere` hook çš„åˆå§‹å€¼ã€‚

ä¾‹å¦‚ï¼Œä½¿ç”¨ `getStaticPropsï¼š`

```jsx
const articleQuery = query({
  // æ³¨æ„ï¼šå½“åœ¨æœåŠ¡ç«¯è¯·æ±‚æ—¶ï¼Œå¿…é¡»æ‰‹åŠ¨è®¾ç½®key
  key: "article",
  fetcher: getArticleFromAPI,
});

export async function getStaticProps() {
  // `getStaticProps` is executed on the server side.
  const queryClient = createQueryClient();

  await queryClient.prefetchQuery({ query: articleQuery });

  return {
    props: {
      dehydratedState: dehydrate(queryClient),
    },
  };
}

function Article() {
  // `data` will always be available as it's in `fallback`.
  const { data } = useQuery({ query: articleQuery });
  return <h1>{data.title}</h1>;
}

export default function Page({ dehydratedState }) {
  return (
    <QueryClientProvider client={queryClient}>
      <HydrationBoundary state={dehydratedState}>
        <Article />
      </HydrationBoundary>
    </QueryClientProvider>
  );
}
```

é¡µé¢ä»ç„¶æ˜¯é¢„æ¸²æŸ“çš„ã€‚å®ƒå¯¹ SEO å‹å¥½ï¼Œå“åº”é€Ÿåº¦å¿«ï¼Œä½†ä¹Ÿå®Œå…¨ç”±å®¢æˆ·ç«¯ç«¯çš„ Quaere æä¾›æ”¯æŒã€‚æ•°æ®å¯ä»¥æ˜¯åŠ¨æ€çš„ï¼Œå¹¶éšæ—¶é—´è‡ªåŠ¨æ›´æ–°ã€‚

<Callout emoji="ğŸ’¡">
  `Article`
  ç»„ä»¶é¦–å…ˆå°†æ¸²æŸ“é¢„ç”Ÿæˆçš„æ•°æ®ï¼Œåœ¨é¡µé¢è¢«æ°´åˆåï¼Œå®ƒå°†å†æ¬¡è¯·æ±‚æœ€æ–°æ•°æ®ä»¥ä¿æŒåˆ·æ–°ã€‚
</Callout>
